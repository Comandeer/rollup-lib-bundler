/*! @comandeer/rollup-lib-bundler v0.14.0 | (c) 2021 Comandeer | MIT license (see LICENSE) */
"use strict";var e=require("console-control-strings"),t=require("console"),r=require("stream"),n=require("gauge"),o=require("fs"),s=require("rollup"),i=require("@rollup/plugin-commonjs"),a=require("rollup-plugin-terser"),u=require("@rollup/plugin-json"),l=require("@rollup/plugin-babel"),c=require("@babel/preset-env");function d(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var p=d(e),f=d(n),g=d(i),m=d(u),h=d(l),b=d(c);const w=Symbol("stdout"),y=Symbol("stderr"),$=Symbol("gauge"),x=Symbol("gaugeTimeout");class v{constructor({stdout:e=process.stdout,stderr:r=process.stderr}={}){if(!j(e))throw new TypeError("Custom stdout must be a valid writable/duplex stream");if(!j(r))throw new TypeError("Custom stderr must be a valid writable/duplex stream");this[w]=e,this[y]=r,this.console=new t.Console({stdout:e,stderr:r}),this[$]=new f.default(e,{enabled:!0,template:[{type:"activityIndicator",kerning:1,length:1},{type:"section",kerning:1,default:"Working…"}]}),this[x]=null,this.pending=[]}showGauge(){const e=()=>{this[$].pulse(),this[x]=setTimeout(e,50)};this[$].show("Working…"),e()}hideGauge(){clearTimeout(this[x]),this[$].hide(),this[x]=null}addLog(...e){this.pending.push(e)}addWarning(e){if(function(e){return e&&"object"==typeof e&&"UNRESOLVED_IMPORT"===e.code}(e))return;const t=function(e){e&&"object"==typeof e&&e.message&&(e=e.message);return`${p.default.color(["yellow","bold"])}⚠️ Warning!⚠️ ${e}${p.default.color("reset")}`}(e);this.pending.push([t])}display(){this.pending.forEach((e=>{this.console.log(...e)}))}displayError(e){const t=function({name:e,message:t,stack:r}){const n=r.split("\n");n.shift();const o=n.join("\n");return`${p.default.color(["bold","red"])}🚨Error🚨\n${e}: ${t}${p.default.color("reset")}\n${o}`}(e);this.console.error(t)}}function j(e){return e instanceof r.Writable||e instanceof r.Duplex}function E(e){if("string"==typeof e)e=function(e){if(!o.existsSync(e))throw new ReferenceError("File with given path does not exist.");const t=o.readFileSync(e,"utf8");let r;try{r=JSON.parse(t)}catch(e){throw new SyntaxError("Given file is not parsable as a correct JSON.")}return r}(e);else if("object"!=typeof e)throw new TypeError("Provide string or object.");return function(e){function t(t){if(void 0===e[t])throw new ReferenceError(`Package metadata must contain "${t}" property.`)}function r(...t){if(!t.some((t=>{const r=t.split(".");return n(e,r)})))throw new ReferenceError(`Package metadata must contain one of ${o(t)} properties or all of them.`)}function n(e,t){const r=t.shift();return void 0!==e[r]&&(0===t.length||n(e[r],t))}function o(e){return e.map(((t,r)=>{const n=`"${t}"`;if(0===r)return n;return`${r===e.length-1?" or ":", "}${n}`})).join("")}t("name"),t("version"),r("exports.require","main"),r("exports.import","module","jsnext:main"),t("author"),t("license")}(e),{name:(t=e).name,version:t.version,author:q(t.author),license:t.license,src:"src/index.js",dist:{esm:S(t),cjs:k(t)}};var t}function q(e){return"object"!=typeof e?String(e):e.name}function S(e){return e.exports&&e.exports.import?e.exports.import:e.module||e["jsnext:main"]}function k(e){return e.exports&&e.exports.require?e.exports.require:e.main}const W=">=12.0.0".replace(/[<=>~^]/g,"");async function T({onWarn:e,packageInfo:t}){const r=function(e,t=(()=>{})){const r=[g.default(),m.default(),h.default({babelrc:!1,babelHelpers:"bundled",presets:[[b.default,{targets:{node:W}}]]}),a.terser()];return{input:e.src,onwarn:t,plugins:r}}(t,e),n=G(t,"cjs"),o=G(t,"esm"),i=await s.rollup(r);await Promise.all([i.write(n),i.write(o)])}function G(e,t="esm"){return{banner:function(e){return`/*! ${e.name} v${e.version} | (c) ${(new Date).getFullYear()} ${e.author} | ${e.license} license (see LICENSE) */`}(e),sourcemap:!0,format:t,file:e.dist[t],exports:"auto"}}module.exports=async function(){const e=new v;try{e.showGauge();const t=E("package.json");await T({onWarn(t){e.addWarning(t)},packageInfo:t}),e.addLog(`${p.default.color(["bold","green"])}Bundling complete!${p.default.color("reset")}`)}catch(t){e.displayError(t),e.addLog(`${p.default.color(["bold","red"])}Bundling failed!${p.default.color("reset")}`)}finally{e.hideGauge(),e.display()}};
//# sourceMappingURL=rollup-lib-bundler.js.map
