/*! @comandeer/rollup-lib-bundler v0.14.0 | (c) 2021 Comandeer | MIT license (see LICENSE) */
import e from"console-control-strings";import{Console as r}from"console";import{Writable as t,Duplex as o}from"stream";import n from"gauge";import{existsSync as s,readFileSync as i}from"fs";import{rollup as a}from"rollup";import c from"@rollup/plugin-commonjs";import{terser as l}from"rollup-plugin-terser";import u from"@rollup/plugin-json";import p from"@rollup/plugin-babel";import m from"@babel/preset-env";const f=Symbol("stdout"),d=Symbol("stderr"),g=Symbol("gauge"),h=Symbol("gaugeTimeout");class w{constructor({stdout:e=process.stdout,stderr:t=process.stderr}={}){if(!b(e))throw new TypeError("Custom stdout must be a valid writable/duplex stream");if(!b(t))throw new TypeError("Custom stderr must be a valid writable/duplex stream");this[f]=e,this[d]=t,this.console=new r({stdout:e,stderr:t}),this[g]=new n(e,{enabled:!0,template:[{type:"activityIndicator",kerning:1,length:1},{type:"section",kerning:1,default:"Working…"}]}),this[h]=null,this.pending=[]}showGauge(){const e=()=>{this[g].pulse(),this[h]=setTimeout(e,50)};this[g].show("Working…"),e()}hideGauge(){clearTimeout(this[h]),this[g].hide(),this[h]=null}addLog(...e){this.pending.push(e)}addWarning(r){if(function(e){return e&&"object"==typeof e&&"UNRESOLVED_IMPORT"===e.code}(r))return;const t=function(r){r&&"object"==typeof r&&r.message&&(r=r.message);return`${e.color(["yellow","bold"])}⚠️ Warning!⚠️ ${r}${e.color("reset")}`}(r);this.pending.push([t])}display(){this.pending.forEach((e=>{this.console.log(...e)}))}displayError(r){const t=function({name:r,message:t,stack:o}){const n=o.split("\n");n.shift();const s=n.join("\n");return`${e.color(["bold","red"])}🚨Error🚨\n${r}: ${t}${e.color("reset")}\n${s}`}(r);this.console.error(t)}}function b(e){return e instanceof t||e instanceof o}function y(e){if("string"==typeof e)e=function(e){if(!s(e))throw new ReferenceError("File with given path does not exist.");const r=i(e,"utf8");let t;try{t=JSON.parse(r)}catch(e){throw new SyntaxError("Given file is not parsable as a correct JSON.")}return t}(e);else if("object"!=typeof e)throw new TypeError("Provide string or object.");return function(e){function r(r){if(void 0===e[r])throw new ReferenceError(`Package metadata must contain "${r}" property.`)}function t(...r){if(!r.some((r=>{const t=r.split(".");return o(e,t)})))throw new ReferenceError(`Package metadata must contain one of ${n(r)} properties or all of them.`)}function o(e,r){const t=r.shift();return void 0!==e[t]&&(0===r.length||o(e[t],r))}function n(e){return e.map(((r,t)=>{const o=`"${r}"`;if(0===t)return o;return`${t===e.length-1?" or ":", "}${o}`})).join("")}r("name"),r("version"),t("exports.require","main"),t("exports.import","module","jsnext:main"),r("author"),r("license")}(e),{name:(r=e).name,version:r.version,author:$(r.author),license:r.license,src:"src/index.js",dist:{esm:x(r),cjs:j(r)}};var r}function $(e){return"object"!=typeof e?String(e):e.name}function x(e){return e.exports&&e.exports.import?e.exports.import:e.module||e["jsnext:main"]}function j(e){return e.exports&&e.exports.require?e.exports.require:e.main}const v=">=12.0.0".replace(/[<=>~^]/g,"");async function E({onWarn:e,packageInfo:r}){const t=function(e,r=(()=>{})){const t=[c(),u(),p({babelrc:!1,babelHelpers:"bundled",presets:[[m,{targets:{node:v}}]]}),l()];return{input:e.src,onwarn:r,plugins:t}}(r,e),o=k(r,"cjs"),n=k(r,"esm"),s=await a(t);await Promise.all([s.write(o),s.write(n)])}function k(e,r="esm"){return{banner:function(e){return`/*! ${e.name} v${e.version} | (c) ${(new Date).getFullYear()} ${e.author} | ${e.license} license (see LICENSE) */`}(e),sourcemap:!0,format:r,file:e.dist[r],exports:"auto"}}async function S(){const r=new w;try{r.showGauge();const t=y("package.json");await E({onWarn(e){r.addWarning(e)},packageInfo:t}),r.addLog(`${e.color(["bold","green"])}Bundling complete!${e.color("reset")}`)}catch(t){r.displayError(t),r.addLog(`${e.color(["bold","red"])}Bundling failed!${e.color("reset")}`)}finally{r.hideGauge(),r.display()}}export default S;
//# sourceMappingURL=rollup-lib-bundler.es2015.js.map
