{"version":3,"file":"rollup-lib-bundler.js","sources":["../src/packageParser.js","../src/generateBanner.js","../src/targets.js","../src/bundler.js","../src/index.js"],"sourcesContent":["import { existsSync } from 'fs';\nimport { readFileSync } from 'fs';\n\nfunction packageParser( metadata ) {\n\tif ( typeof metadata === 'string' ) {\n\t\tmetadata = loadAndParseFile( metadata );\n\t} else if ( typeof metadata !== 'object' ) {\n\t\tthrow new TypeError( 'Provide string or object.' );\n\t}\n\n\tlintObject( metadata );\n\n\treturn prepareMetadata( metadata );\n}\n\nfunction loadAndParseFile( path ) {\n\tif ( !existsSync( path ) ) {\n\t\tthrow new ReferenceError( 'File with given path does not exist.' );\n\t}\n\n\tconst contents = readFileSync( path );\n\tlet parsed;\n\n\ttry {\n\t\tparsed = JSON.parse( contents );\n\t} catch ( e ) {\n\t\tthrow new SyntaxError( 'Given file is not parsable as a correct JSON.' );\n\t}\n\n\treturn parsed;\n}\n\nfunction lintObject( obj ) {\n\tfunction checkProperty( name ) {\n\t\tif ( typeof obj[ name ] === 'undefined' ) {\n\t\t\tthrow new ReferenceError( `Package metadata must contain \"${ name }\" property.` );\n\t\t}\n\t}\n\n\tfunction checkProperties( name1, name2 ) {\n\t\tif ( typeof obj[ name1 ] === 'undefined' && typeof obj[ name2 ] === 'undefined' ) {\n\t\t\tthrow new ReferenceError( `Package metadata must contain either \"${ name1 }\" or \"${ name2 }\" or both properties.` );\n\t\t}\n\t}\n\n\tcheckProperty( 'name' );\n\tcheckProperty( 'version' );\n\tcheckProperty( 'main' );\n\tcheckProperties( 'module', 'jsnext:main' );\n\tcheckProperty( 'author' );\n\tcheckProperty( 'license' );\n}\n\nfunction prepareAuthorMetadata( author ) {\n\tif ( typeof author !== 'object' ) {\n\t\treturn String( author );\n\t}\n\n\treturn author.name;\n}\n\nfunction prepareMetadata( obj ) {\n\treturn {\n\t\tname: obj.name,\n\t\tversion: obj.version,\n\t\tauthor: prepareAuthorMetadata( obj.author ),\n\t\tlicense: obj.license,\n\t\tsrc: 'src/index.js',\n\t\tdist: {\n\t\t\tesm: obj.module || obj[ 'jsnext:main' ],\n\t\t\tcjs: obj.main\n\t\t}\n\t};\n}\n\nexport default packageParser;\n","function generateBanner( metadata ) {\n\treturn `/*! ${metadata.name} v${metadata.version} | (c) ${new Date().getFullYear()} ${metadata.author} | ${metadata.license} license (see LICENSE) */`;\n}\n\nexport default generateBanner;\n","const node = '10.0.0';\n\nexport { node };\n","import { rollup } from 'rollup';\nimport convertCJS from 'rollup-plugin-commonjs';\nimport { terser } from 'rollup-plugin-terser';\nimport babel from 'rollup-plugin-babel';\nimport preset from '@babel/preset-env';\nimport generateBanner from './generateBanner.js';\nimport { node as nodeTarget } from './targets.js';\n\nfunction bundler( metadata ) {\n\tconst configCJS = getRollupConfig( metadata, true );\n\tconst configESM = getRollupConfig( metadata, false );\n\n\treturn Promise.all( [\n\t\trollup( configCJS ),\n\t\trollup( configESM )\n\t] ).then( ( bundles ) => {\n\t\treturn Promise.all( [\n\t\t\tbundles[ 0 ].write( configCJS.output ),\n\t\t\tbundles[ 1 ].write( configESM.output )\n\t\t] );\n\t} );\n}\n\nfunction getRollupConfig( metadata, isCJS ) {\n\tconst banner = generateBanner( metadata );\n\tconst plugins = [\n\t\tconvertCJS(),\n\n\t\tbabel( {\n\t\t\tbabelrc: false,\n\t\t\tpresets: [\n\t\t\t\t[\n\t\t\t\t\tpreset,\n\t\t\t\t\t{\n\t\t\t\t\t\ttargets: {\n\t\t\t\t\t\t\tnode: nodeTarget\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t]\n\t\t} ),\n\n\t\tterser()\n\t];\n\n\treturn {\n\t\tinput: metadata.src,\n\t\tplugins,\n\t\toutput: {\n\t\t\tbanner,\n\t\t\tsourcemap: true,\n\t\t\tformat: isCJS ? 'cjs' : 'es',\n\t\t\tfile: isCJS ? metadata.dist.cjs : metadata.dist.esm\n\t\t}\n\t};\n}\n\nexport default bundler;\n","import packageParser from './packageParser.js';\nimport bundler from './bundler.js';\n\nfunction rlb() {\n\tconst metadata = packageParser( 'package.json' );\n\n\treturn bundler( metadata );\n}\n\nexport default rlb;\n"],"names":["packageParser","metadata","loadAndParseFile","TypeError","lintObject","prepareMetadata","path","existsSync","ReferenceError","contents","readFileSync","parsed","JSON","parse","e","SyntaxError","obj","checkProperty","name","name1","name2","checkProperties","prepareAuthorMetadata","author","version","license","src","dist","esm","module","cjs","main","generateBanner","Date","getFullYear","node","bundler","configCJS","getRollupConfig","configESM","Promise","all","rollup","then","bundles","write","output","isCJS","banner","plugins","convertCJS","babel","babelrc","presets","preset","targets","nodeTarget","terser","input","sourcemap","format","file","rlb"],"mappings":"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"}