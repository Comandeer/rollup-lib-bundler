{"version":3,"file":"rollup-lib-bundler.js","sources":["../src/generateBanner.js","../src/packageParser.js","../src/bundler.js","../src/index.js"],"sourcesContent":["function generateBanner( metadata ) {\n\treturn `/*! ${metadata.name} v${metadata.version} | (c) ${new Date().getFullYear()} ${metadata.author} | ${metadata.license} license (see LICENSE) */`;\n}\n\nexport default generateBanner;\n","import { existsSync, readFileSync } from 'fs';\n\nfunction loadAndParseFile( path ) {\n\tif ( !existsSync( path ) ) {\n\t\tthrow new ReferenceError( 'File with given path does not exist.' );\n\t}\n\n\tconst contents = readFileSync( path );\n\tlet parsed;\n\n\ttry {\n\t\tparsed = JSON.parse( contents );\n\t} catch ( e ) {\n\t\tthrow new SyntaxError( 'Given file is not parsable as a correct JSON.' );\n\t}\n\n\treturn parsed;\n}\n\nfunction lintObject( obj ) {\n\tfunction checkProperty( name ) {\n\t\tif ( typeof obj[ name ] === 'undefined' ) {\n\t\t\tthrow new ReferenceError( `Package metadata must contain \"${ name }\" property.` );\n\t\t}\n\t}\n\n\tfunction checkProperties( name1, name2 ) {\n\t\tif ( typeof obj[ name1 ] === 'undefined' && typeof obj[ name2 ] === 'undefined' ) {\n\t\t\tthrow new ReferenceError( `Package metadata must contain either \"${ name1 }\" or \"${ name2 }\" or both properties.` );\n\t\t}\n\t}\n\n\tcheckProperty( 'name' );\n\tcheckProperty( 'version' );\n\tcheckProperty( 'main' );\n\tcheckProperties( 'module', 'jsnext:main' );\n\tcheckProperty( 'author' );\n\tcheckProperty( 'license' );\n}\n\nfunction prepareAuthorMetadata( author ) {\n\tif ( typeof author !== 'object' ) {\n\t\treturn String( author );\n\t}\n\n\treturn author.name;\n}\n\nfunction prepareMetadata( obj ) {\n\treturn {\n\t\tname: obj.name,\n\t\tversion: obj.version,\n\t\tauthor: prepareAuthorMetadata( obj.author ),\n\t\tlicense: obj.license,\n\t\tsrc: 'src/index.js',\n\t\tdist: {\n\t\t\tes2015: obj.module || obj[ 'jsnext:main' ],\n\t\t\tes5: obj.main\n\t\t}\n\t};\n}\n\nfunction packageParser( metadata ) {\n\tif ( typeof metadata === 'string' ) {\n\t\tmetadata = loadAndParseFile( metadata );\n\t} else if ( typeof metadata !== 'object' ) {\n\t\tthrow new TypeError( 'Provide string or object.' );\n\t}\n\n\tlintObject( metadata );\n\n\treturn prepareMetadata( metadata );\n}\n\nexport default packageParser;\n","import generateBanner from './generateBanner.js';\nimport { rollup } from 'rollup';\nimport convertCJS from 'rollup-plugin-commonjs';\nimport minify from 'rollup-plugin-babel-minify';\nimport babel from 'rollup-plugin-babel';\nimport preset from '@comandeer/babel-preset-rollup';\n\nfunction getRollupConfig( metadata, isEs5 ) {\n\tconst banner = generateBanner( metadata );\n\tconst plugins = [\n\t\tconvertCJS(),\n\t\tminify( {\n\t\t\tcomments: false,\n\t\t\tbanner\n\t\t} )\n\t];\n\n\tif ( isEs5 ) {\n\t\tplugins.splice( 1, 0, babel( {\n\t\t\tpresets: [\n\t\t\t\t[ preset ]\n\t\t\t]\n\t\t} ) );\n\t}\n\n\treturn {\n\t\tinput: metadata.src,\n\t\tplugins,\n\t\tbanner,\n\t\toutput: {\n\t\t\tsourcemap: true,\n\t\t\tformat: isEs5 ? 'cjs' : 'es',\n\t\t\tfile: isEs5 ? metadata.dist.es5 : metadata.dist.es2015\n\t\t}\n\t};\n}\n\nfunction bundler( metadata ) {\n\tconst configEs5 = getRollupConfig( metadata, true );\n\tconst configEs2015 = getRollupConfig( metadata, false );\n\n\treturn Promise.all( [\n\t\trollup( configEs5 ),\n\t\trollup( configEs2015 )\n\t] ).then( ( bundles ) => {\n\t\treturn Promise.all( [\n\t\t\tbundles[ 0 ].write( configEs5.output ),\n\t\t\tbundles[ 1 ].write( configEs2015.output )\n\t\t] );\n\t} );\n}\n\nexport default bundler;\n","import generateBanner from './generateBanner.js';\nimport packageParser from './packageParser.js';\nimport bundler from './bundler';\n\nfunction rlb() {\n\tconst metadata = packageParser( 'package.json' );\n\n\treturn bundler( metadata );\n}\n\nexport default rlb;\nexport { bundler };\nexport { packageParser };\nexport { generateBanner };\n"],"names":["generateBanner","metadata","name","version","Date","getFullYear","author","license","loadAndParseFile","existsSync","ReferenceError","parsed","contents","readFileSync","JSON","parse","SyntaxError","lintObject","obj","prepareAuthorMetadata","prepareMetadata","module","main","packageParser","TypeError","getRollupConfig","banner","plugins","convertCJS","minify","splice","babel","preset","src","isEs5","dist","es5","es2015","bundler","configEs5","configEs2015","Promise","all","rollup","then","bundles","write","output","rlb"],"mappings":"yhBAAA,QAASA,eAAT,GAAoC,cACrBC,EAASC,SAASD,EAASE,iBAAiB,GAAIC,KAAJ,GAAWC,WAAX,MAA4BJ,EAASK,YAAYL,EAASM,mCCCrH,QAASC,iBAAT,GAAkC,IAC5B,CAACC,aAAAA,SACC,IAAIC,eAAJ,CAAoB,sCAApB,KAIHC,GADEC,EAAWC,eAAAA,OAGb,GACMC,KAAKC,KAALD,GADV,CAEE,QAAY,MACP,IAAIE,YAAJ,CAAiB,+CAAjB,WAMR,QAASC,WAAT,GAA2B,cACK,IACF,WAAvB,QAAOC,WACL,IAAIR,eAAJ,mCAAqB,cAArB,IAUO,OAbW,GAcX,UAdW,GAeX,OAfW,cAOe,IACX,WAAxB,QAAOQ,KAAP,EAA+D,WAAxB,QAAOA,WAC5C,IAAIR,eAAJ,0CAAqB,UAAA,wBAArB,GAOS,SAAU,cAhBD,GAiBX,SAjBW,GAkBX,WAGhB,QAASS,sBAAT,GAAyC,OACjB,QAAlB,UADmC,CAKjCb,EAAOJ,IAL0B,MAQzC,QAASkB,gBAAT,GAAgC,OACxB,MACAF,EAAIhB,IADJ,SAEGgB,EAAIf,OAFP,QAGEgB,sBAAuBD,EAAIZ,MAA3Ba,CAHF,SAIGD,EAAIX,OAJP,KAKD,cALC,MAMA,QACGW,EAAIG,MAAJH,EAAcA,EAAK,aAALA,CADjB,KAEAA,EAAII,IAFJ,CANA,EAaR,QAASC,cAAT,GAAmC,IACT,QAApB,aACOf,wBACL,IAAyB,QAApB,UAAL,MACA,IAAIgB,UAAJ,CAAe,2BAAf,uBAKAJ,mBChER,QAASK,gBAAT,KAA4C,IACrCC,GAAS1B,kBACT2B,EAAU,CACfC,YADe,CAEfC,OAAQ,YAAA,SAAA,CAARA,CAFe,cASPC,OAAQ,EAAG,EAAGC,MAAO,SACnB,CACR,CAAEC,MAAF,CADQ,CADmB,CAAPD,GAOhB,OACC9B,EAASgC,GADV,UAAA,SAAA,QAIE,aAAA,QAECC,EAAQ,KAARA,CAAgB,IAFjB,MAGDA,EAAQjC,EAASkC,IAATlC,CAAcmC,GAAtBF,CAA4BjC,EAASkC,IAATlC,CAAcoC,MAHzC,CAJF,EAYR,QAASC,QAAT,GAA6B,IACtBC,GAAYd,sBACZe,EAAef,4BAEdgB,SAAQC,GAARD,CAAa,CACnBE,aAAAA,GADmB,CAEnBA,aAAAA,GAFmB,CAAbF,EAGHG,IAHGH,CAGG,WAAe,OACjBA,SAAQC,GAARD,CAAa,CACnBI,EAAS,CAATA,EAAaC,KAAbD,CAAoBN,EAAUQ,MAA9BF,CADmB,CAEnBA,EAAS,CAATA,EAAaC,KAAbD,CAAoBL,EAAaO,MAAjCF,CAFmB,CAAbJ,CAJD,CAAAA,ECrCR,QAASO,IAAT,EAAe,IACR/C,GAAWsB,cAAe,cAAfA,QAEVe"}