{"version":3,"file":"rollup-lib-bundler.js","sources":["../src/OutputController.js","../src/packageParser.js","../src/targets.js","../src/bundler.js","../src/generateBanner.js","../src/rlb.js"],"sourcesContent":["import { Console } from 'console';\nimport { Writable as WritableStream } from 'stream';\nimport { Duplex as DuplexStream } from 'stream';\nimport Spinner from '@comandeer/cli-spinner';\nimport consoleControlStrings from 'console-control-strings';\n\nconst stdoutSymbol = Symbol( 'stdout' );\nconst stderrSymbol = Symbol( 'stderr' );\nconst spinnerSymbol = Symbol( 'spinner' );\n\nclass OutputController {\n\tconstructor( {\n\t\tstdout = process.stdout,\n\t\tstderr = process.stderr\n\t} = {} ) {\n\t\tif ( !isValidStream( stdout ) ) {\n\t\t\tthrow new TypeError( 'Custom stdout must be a valid writable/duplex stream' );\n\t\t}\n\n\t\tif ( !isValidStream( stderr ) ) {\n\t\t\tthrow new TypeError( 'Custom stderr must be a valid writable/duplex stream' );\n\t\t}\n\n\t\tthis[ stdoutSymbol ] = stdout;\n\t\tthis[ stderrSymbol ] = stderr;\n\t\tthis.console = new Console( {\n\t\t\tstdout,\n\t\t\tstderr\n\t\t} );\n\t\tthis[ spinnerSymbol ] = new Spinner( {\n\t\t\tlabel: 'Working…',\n\t\t\tstdout: stderr\n\t\t} );\n\t\tthis.pendingLogs = [];\n\t\tthis.pendingWarnings = [];\n\t}\n\n\t/* istanbul ignore next */\n\tasync showSpinner() {\n\t\treturn this[ spinnerSymbol ].show();\n\t}\n\n\t/* istanbul ignore next */\n\tasync hideSpinner() {\n\t\treturn this[ spinnerSymbol ].hide();\n\t}\n\n\taddLog( ...args ) {\n\t\tthis.pendingLogs.push( args );\n\t}\n\n\taddWarning( warningMessage ) {\n\t\tif ( isExternalDepWarning( warningMessage ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst warning = createWarning( warningMessage );\n\n\t\tthis.pendingWarnings.push( [ warning ] );\n\t}\n\n\tdisplay() {\n\t\tthis.pendingWarnings.forEach( ( warning ) => {\n\t\t\tthis.console.warn( ...warning );\n\t\t} );\n\n\t\tthis.pendingLogs.forEach( ( log ) => {\n\t\t\tthis.console.log( ...log );\n\t\t} );\n\t}\n\n\tdisplayError( error ) {\n\t\tconst errorLog = createError( error );\n\n\t\tthis.console.error( errorLog );\n\t}\n}\n\nfunction isValidStream( value ) {\n\treturn value instanceof WritableStream || value instanceof DuplexStream;\n}\n\nfunction isExternalDepWarning( log ) {\n\treturn log && typeof log === 'object' && log.code === 'UNRESOLVED_IMPORT';\n}\n\nfunction createWarning( warning ) {\n\tif ( warning && typeof warning === 'object' && warning.message ) {\n\t\twarning = warning.message;\n\t}\n\n\treturn `${ consoleControlStrings.color( [ 'yellow', 'bold' ] ) }⚠️ Warning!⚠️ ${ warning }${ consoleControlStrings.color( 'reset' ) }`;\n}\n\nfunction createError( { name, message, stack } ) {\n\tconst stackParts = stack.split( '\\n' );\n\n\tstackParts.shift();\n\n\tconst newStack = stackParts.join( '\\n' );\n\n\treturn `${ consoleControlStrings.color( [ 'bold', 'red' ] ) }🚨Error🚨\n${ name }: ${ message }${ consoleControlStrings.color( 'reset' ) }\n${ newStack }`;\n}\n\nexport default OutputController;\n","import { existsSync } from 'fs';\nimport { readFileSync } from 'fs';\nimport { join as joinPath } from 'path';\n\nfunction packageParser( metadata ) {\n\tif ( typeof metadata === 'string' ) {\n\t\tmetadata = loadAndParseFile( metadata );\n\t} else if ( typeof metadata !== 'object' ) {\n\t\tthrow new TypeError( 'Provide string or object.' );\n\t}\n\n\tlintObject( metadata );\n\n\treturn prepareMetadata( metadata );\n}\n\nfunction loadAndParseFile( path ) {\n\tif ( !existsSync( path ) ) {\n\t\tthrow new ReferenceError( 'File with given path does not exist.' );\n\t}\n\n\tconst contents = readFileSync( path, 'utf8' );\n\tlet parsed;\n\n\ttry {\n\t\tparsed = JSON.parse( contents );\n\t} catch ( e ) {\n\t\tthrow new SyntaxError( 'Given file is not parsable as a correct JSON.' );\n\t}\n\n\treturn parsed;\n}\n\nfunction lintObject( obj ) {\n\tcheckProperty( 'name' );\n\tcheckProperty( 'version' );\n\tcheckProperties( 'exports/./import', 'exports/import', 'module', 'jsnext:main' );\n\tcheckProperty( 'author' );\n\tcheckProperty( 'license' );\n\n\tfunction checkProperty( name ) {\n\t\tif ( typeof obj[ name ] === 'undefined' ) {\n\t\t\tthrow new ReferenceError( `Package metadata must contain \"${ name }\" property.` );\n\t\t}\n\t}\n\n\tfunction checkProperties( ...properties ) {\n\t\tconst isAtLeastOnePresent = properties.some( ( property ) => {\n\t\t\tconst propertyPath = property.split( '/' );\n\n\t\t\treturn checkPropertyExistence( obj, propertyPath );\n\t\t} );\n\n\t\tif ( !isAtLeastOnePresent ) {\n\t\t\tthrow new ReferenceError( `Package metadata must contain one of ${ prepareNamesForError( properties ) } properties or all of them.` );\n\t\t}\n\t}\n\n\tfunction checkPropertyExistence( obj, propertyPath ) {\n\t\tconst currentProperty = propertyPath.shift();\n\n\t\tif ( typeof obj[ currentProperty ] === 'undefined' ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif ( propertyPath.length === 0 ) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn checkPropertyExistence( obj[ currentProperty ], propertyPath );\n\t}\n\n\tfunction prepareNamesForError( names ) {\n\t\treturn names.map( ( name, i ) => {\n\t\t\tconst formattedName = formatName( name );\n\t\t\tconst quotedName = `\"${ formattedName }\"`;\n\n\t\t\tif ( i === 0 ) {\n\t\t\t\treturn quotedName;\n\t\t\t}\n\n\t\t\tconst conjuction = ( i === names.length - 1 ) ? ' or ' : ', ';\n\n\t\t\treturn `${ conjuction}${ quotedName }`;\n\t\t} ).join( '' );\n\n\t\tfunction formatName( name ) {\n\t\t\t// Thanks to using capturing groups, the separator will be preserved\n\t\t\t// in the splitted string.\n\t\t\tconst separatorRegex = /(\\/)/g;\n\t\t\tconst nameParts = name.split( separatorRegex );\n\n\t\t\treturn nameParts.reduce( ( parts, part ) => {\n\t\t\t\tconst lastPart = parts[ parts.length - 1 ];\n\n\t\t\t\tif ( part.startsWith( '.' ) && lastPart === '.' ) {\n\t\t\t\t\treturn [ ...parts.slice( 0, -1 ), '[ \\'', part ];\n\t\t\t\t}\n\n\t\t\t\tif ( part === '/' && lastPart.startsWith( '.' ) ) {\n\t\t\t\t\treturn [ ...parts, '\\' ].' ];\n\t\t\t\t}\n\n\t\t\t\tif ( part === '/' ) {\n\t\t\t\t\treturn [ ...parts, '.' ];\n\t\t\t\t}\n\n\t\t\t\treturn [ ...parts, part ];\n\t\t\t}, [] ).join( '' );\n\t\t}\n\t}\n}\n\nfunction prepareMetadata( metadata ) {\n\treturn {\n\t\tname: metadata.name,\n\t\tversion: metadata.version,\n\t\tauthor: prepareAuthorMetadata( metadata.author ),\n\t\tlicense: metadata.license,\n\t\tdist: prepareDistMetadata( metadata )\n\t};\n}\n\nfunction prepareAuthorMetadata( author ) {\n\tif ( typeof author !== 'object' ) {\n\t\treturn String( author );\n\t}\n\n\treturn author.name;\n}\n\nfunction prepareDistMetadata( metadata ) {\n\tconst subpaths = getSubPaths( metadata );\n\n\treturn subpaths.reduce( ( targets, subpath ) => {\n\t\tconst currentTargets = prepareExportMetadata( metadata, subpath );\n\n\t\treturn { ...targets, ...currentTargets };\n\t}, {} );\n}\n\nfunction getSubPaths( metadata ) {\n\tconst exports = metadata.exports;\n\n\tif ( !exports ) {\n\t\treturn [\n\t\t\t'.'\n\t\t];\n\t}\n\n\tconst subpaths = Object.keys( exports ).filter( ( subpath ) => {\n\t\treturn subpath.startsWith( '.' );\n\t} );\n\n\tif ( !subpaths.includes( '.' ) ) {\n\t\tsubpaths.unshift( '.' );\n\t}\n\n\treturn subpaths;\n}\n\nfunction prepareExportMetadata( metadata, subPath ) {\n\tconst subPathFileName = subPath === '.' ? 'index' : subPath;\n\tconst subPathFilePath = subPathFileName.endsWith( '.js' ) ? subPathFileName : `${ subPathFileName }.js`;\n\tconst srcPath = joinPath( 'src', subPathFilePath );\n\tconst esmTarget = getESMTarget( metadata, subPath );\n\tconst cjsTarget = getCJSTarget( metadata, subPath );\n\tconst exportMetadata = {\n\t\tesm: esmTarget\n\t};\n\n\tif ( cjsTarget ) {\n\t\texportMetadata.cjs = cjsTarget;\n\t}\n\n\treturn {\n\t\t[ srcPath ]: exportMetadata\n\t};\n}\n\nfunction getESMTarget( metadata, subPath ) {\n\tconst exportsTarget = getExportsTarget( metadata, subPath, 'import' );\n\n\tif ( subPath === '.' ) {\n\t\treturn exportsTarget || metadata.module || metadata[ 'jsnext:main' ];\n\t}\n\n\treturn exportsTarget;\n}\n\nfunction getCJSTarget( metadata, subPath ) {\n\tconst exportsTarget = getExportsTarget( metadata, subPath, 'require' );\n\n\tif ( subPath === '.' ) {\n\t\treturn exportsTarget || metadata.main;\n\t}\n\n\treturn exportsTarget;\n}\n\nfunction getExportsTarget( metadata, subPath, type ) {\n\tif ( !metadata.exports ) {\n\t\treturn null;\n\t}\n\n\tconst exports = metadata.exports;\n\n\tif ( exports[ subPath ] ) {\n\t\treturn exports[ subPath ][ type ];\n\t}\n\n\tif ( !exports[ subPath ] && subPath === '.' ) {\n\t\treturn exports[ type ];\n\t}\n\n\treturn null;\n}\n\nexport default packageParser;\n","import { engines } from '../package.json';\n\nconst node = engines.node.replace( /[<=>~^]/g, '' );\n\nexport { node };\n","import { rollup } from 'rollup';\nimport convertCJS from '@rollup/plugin-commonjs';\nimport { terser } from 'rollup-plugin-terser';\nimport json from '@rollup/plugin-json';\nimport babel from '@rollup/plugin-babel';\nimport preset from '@babel/preset-env';\nimport generateBanner from './generateBanner.js';\nimport { node as nodeTarget } from './targets.js';\n\nasync function bundler( {\n\tonWarn,\n\tpackageInfo\n} ) {\n\tawait Promise.all( bundleChunks( packageInfo, onWarn ) );\n}\n\nfunction bundleChunks( packageInfo, onWarn = () => {} ) {\n\tconst distInfo = Object.entries( packageInfo.dist );\n\n\treturn distInfo.map( ( [ source, output ] ) => {\n\t\treturn bundleChunk( packageInfo, source, output, { onWarn } );\n\t} );\n}\n\nasync function bundleChunk( packageInfo, source, output, { onWarn = () => {} } = {} ) {\n\tconst banner = generateBanner( packageInfo );\n\tconst inputConfig = getRollupInputConfig( source, onWarn );\n\n\tconst otuputConfigESM = getRollupOutputConfig( output.esm, banner, 'esm' );\n\n\tconst bundle = await rollup( inputConfig );\n\tconst bundlesPromises = [\n\t\tbundle.write( otuputConfigESM )\n\t];\n\n\tif ( output.cjs ) {\n\t\tconst outputConfigCJS = getRollupOutputConfig( output.cjs, banner, 'cjs' );\n\n\t\tbundlesPromises.push( bundle.write( outputConfigCJS ) );\n\t} else {\n\t\tonWarn( `Skipping CJS build for ${ source }` );\n\t}\n\n\tawait Promise.all( bundlesPromises );\n}\n\nfunction getRollupInputConfig( input, onwarn = () => {} ) {\n\tconst plugins = [\n\t\tconvertCJS(),\n\n\t\tjson(),\n\n\t\t{\n\t\t\trenderDynamicImport() {\n\t\t\t\treturn {\n\t\t\t\t\tleft: 'import(',\n\t\t\t\t\tright: ');'\n\t\t\t\t};\n\t\t\t}\n\t\t},\n\n\t\tbabel( {\n\t\t\tbabelrc: false,\n\t\t\tbabelHelpers: 'bundled',\n\t\t\tpresets: [\n\t\t\t\t[\n\t\t\t\t\tpreset,\n\t\t\t\t\t{\n\t\t\t\t\t\ttargets: {\n\t\t\t\t\t\t\tnode: nodeTarget\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t]\n\t\t} ),\n\n\t\tterser()\n\t];\n\n\treturn {\n\t\tinput,\n\t\tonwarn,\n\t\tplugins\n\t};\n}\n\nfunction getRollupOutputConfig( outputPath, banner, format = 'esm' ) {\n\treturn {\n\t\tbanner,\n\t\tsourcemap: true,\n\t\tformat,\n\t\tfile: outputPath,\n\t\texports: 'auto'\n\t};\n}\n\nexport default bundler;\n","function generateBanner( metadata ) {\n\treturn `/*! ${metadata.name} v${metadata.version} | (c) ${new Date().getFullYear()} ${metadata.author} | ${metadata.license} license (see LICENSE) */`;\n}\n\nexport default generateBanner;\n","/* istanbul ignore file */\nimport { resolve as resolvePath } from 'path';\nimport rimraf from 'rimraf';\nimport consoleControlStrings from 'console-control-strings';\nimport OutputController from './OutputController.js';\nimport packageParser from './packageParser.js';\nimport bundler from './bundler.js';\n\nasync function rlb() {\n\tconst outputController = new OutputController();\n\n\ttry {\n\t\tawait outputController.showSpinner();\n\n\t\tconst distPath = resolvePath( process.cwd(), 'dist' );\n\n\t\tawait rimrafPromise( distPath );\n\n\t\tconst packageInfo = packageParser( 'package.json' );\n\n\t\tawait bundler( {\n\t\t\tonWarn( warning ) {\n\t\t\t\toutputController.addWarning( warning );\n\t\t\t},\n\t\t\tpackageInfo\n\t\t} );\n\n\t\toutputController.addLog( `${ consoleControlStrings.color( [ 'bold', 'green' ] ) }Bundling complete!${ consoleControlStrings.color( 'reset' ) }` );\n\t} catch ( error ) {\n\t\toutputController.displayError( error );\n\t\toutputController.addLog( `${ consoleControlStrings.color( [ 'bold', 'red' ] ) }Bundling failed!${ consoleControlStrings.color( 'reset' ) }` );\n\t} finally {\n\t\tawait outputController.hideSpinner();\n\t\toutputController.display();\n\t}\n}\n\nfunction rimrafPromise( path ) {\n\treturn new Promise( ( resolve, reject ) => {\n\t\trimraf( path, ( error ) => {\n\t\t\tif ( error ) {\n\t\t\t\treturn reject( error );\n\t\t\t}\n\n\t\t\tresolve();\n\t\t} );\n\t} );\n}\n\nexport default rlb;\n"],"names":["stdoutSymbol","Symbol","stderrSymbol","spinnerSymbol","OutputController","constructor","stdout","process","stderr","isValidStream","TypeError","this","console","Console","Spinner","label","pendingLogs","pendingWarnings","async","show","hide","addLog","args","push","addWarning","warningMessage","log","code","warning","message","consoleControlStrings","color","createWarning","display","forEach","warn","displayError","error","errorLog","name","stack","stackParts","split","shift","newStack","join","createError","value","WritableStream","DuplexStream","packageParser","metadata","path","existsSync","ReferenceError","contents","readFileSync","parsed","JSON","parse","e","SyntaxError","loadAndParseFile","obj","checkProperty","checkProperties","properties","some","property","propertyPath","checkPropertyExistence","prepareNamesForError","currentProperty","length","names","map","i","quotedName","formatName","separatorRegex","reduce","parts","part","lastPart","startsWith","slice","lintObject","version","author","prepareAuthorMetadata","license","dist","prepareDistMetadata","prepareMetadata","String","subpaths","exports","Object","keys","filter","subpath","includes","unshift","getSubPaths","targets","currentTargets","subPath","subPathFileName","subPathFilePath","endsWith","srcPath","joinPath","esmTarget","exportsTarget","getExportsTarget","module","getESMTarget","cjsTarget","main","getCJSTarget","exportMetadata","esm","cjs","prepareExportMetadata","type","node","replace","bundler","onWarn","packageInfo","Promise","all","entries","source","output","banner","Date","getFullYear","inputConfig","input","onwarn","plugins","convertCJS","json","renderDynamicImport","left","right","babel","babelrc","babelHelpers","presets","preset","nodeTarget","terser","getRollupInputConfig","otuputConfigESM","getRollupOutputConfig","bundle","rollup","bundlesPromises","write","outputConfigCJS","bundleChunk","bundleChunks","outputPath","format","sourcemap","file","outputController","showSpinner","distPath","resolvePath","cwd","resolve","reject","rimraf","rimrafPromise","hideSpinner"],"mappings":"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"}