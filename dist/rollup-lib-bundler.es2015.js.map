{"version":3,"file":"rollup-lib-bundler.es2015.js","sources":["../src/packageParser.js","../src/bundler.js","../src/index.js"],"sourcesContent":["import { existsSync, readFileSync } from 'fs';\n\nfunction loadAndParseFile( path ) {\n\tif ( !existsSync( path ) ) {\n\t\tthrow new ReferenceError( 'File with given path does not exist.' );\n\t}\n\n\tconst contents = readFileSync( path );\n\tlet parsed;\n\n\ttry {\n\t\tparsed = JSON.parse( contents );\n\t} catch ( e ) {\n\t\tthrow new SyntaxError( 'Given file is not parsable as a correct JSON.' );\n\t}\n\n\treturn parsed;\n}\n\nfunction lintObject( obj ) {\n\tfunction checkProperty( name ) {\n\t\tif ( typeof obj[ name ] === 'undefined' ) {\n\t\t\tthrow new ReferenceError( `Package metadata must contain \"${ name }\" property.` );\n\t\t}\n\t}\n\n\tfunction checkProperties( name1, name2 ) {\n\t\tif ( typeof obj[ name1 ] === 'undefined' && typeof obj[ name2 ] === 'undefined' ) {\n\t\t\tthrow new ReferenceError( `Package metadata must contain either \"${ name1 }\" or \"${ name2 }\" or both properties.` );\n\t\t}\n\t}\n\n\tcheckProperty( 'name' );\n\tcheckProperty( 'version' );\n\tcheckProperty( 'main' );\n\tcheckProperties( 'module', 'jsnext:main' );\n\tcheckProperty( 'author' );\n\tcheckProperty( 'license' );\n}\n\nfunction prepareAuthorMetadata( author ) {\n\tif ( typeof author !== 'object' ) {\n\t\treturn String( author );\n\t}\n\n\treturn author.name;\n}\n\nfunction prepareMetadata( obj ) {\n\treturn {\n\t\tname: obj.name,\n\t\tversion: obj.version,\n\t\tauthor: prepareAuthorMetadata( obj.author ),\n\t\tlicense: obj.license,\n\t\tsrc: 'src/index.js',\n\t\tdist: {\n\t\t\tes2015: obj.module || obj[ 'jsnext:main' ],\n\t\t\tes5: obj.main\n\t\t}\n\t};\n}\n\nfunction packageParser( metadata ) {\n\tif ( typeof metadata === 'string' ) {\n\t\tmetadata = loadAndParseFile( metadata );\n\t} else if ( typeof metadata !== 'object' ) {\n\t\tthrow new TypeError( 'Provide string or object.' );\n\t}\n\n\tlintObject( metadata );\n\n\treturn prepareMetadata( metadata );\n}\n\nexport default packageParser;\n","import { rollup } from 'rollup';\nimport convertCJS from 'rollup-plugin-commonjs';\nimport babili from 'rollup-plugin-babili';\nimport babel from 'rollup-plugin-babel';\nimport preset from 'babel-preset-es2015-rollup';\nimport uglify from 'rollup-plugin-uglify';\n\nfunction getRollupConfig( metadata, isEs5 ) {\n\tconst banner = `/*! ${metadata.name} v${metadata.version} | (c) ${new Date().getFullYear()} ${metadata.author} | ${metadata.license} license (see LICENSE) */`;\n\tconst plugins = [\n\t\tconvertCJS(),\n\t\tbabili( {\n\t\t\tcomments: false,\n\t\t\tbanner\n\t\t} )\n\t];\n\n\tif ( isEs5 ) {\n\t\tplugins[ 1 ] = babel( {\n\t\t\tpresets: [\n\t\t\t\t[ preset ]\n\t\t\t]\n\t\t} );\n\n\t\tplugins.push( uglify( {\n\t\t\toutput: {\n\t\t\t\tpreamble: banner\n\t\t\t}\n\t\t} ) );\n\t}\n\n\treturn {\n\t\tentry: metadata.src,\n\t\tformat: isEs5 ? 'cjs' : 'es',\n\t\tsourceMap: true,\n\t\tplugins,\n\t\tbanner,\n\t\tdest: isEs5 ? metadata.dist.es5 : metadata.dist.es2015\n\t};\n}\n\nfunction bundler( metadata ) {\n\tconst configEs5 = getRollupConfig( metadata, true );\n\tconst configEs2015 = getRollupConfig( metadata, false );\n\n\treturn Promise.all( [\n\t\trollup( configEs5 ),\n\t\trollup( configEs2015 )\n\t] ).then( ( bundles ) => {\n\t\treturn Promise.all( [\n\t\t\tbundles[ 0 ].write( configEs5 ),\n\t\t\tbundles[ 1 ].write( configEs2015 )\n\t\t] );\n\t} );\n}\n\nexport default bundler;\n","import packageParser from './packageParser.js';\nimport bundler from './bundler';\n\nfunction rlb() {\n\tconst metadata = packageParser( 'package.json' );\n\n\treturn bundler( metadata );\n}\n\nexport default rlb;\nexport { bundler };\nexport { packageParser };\n"],"names":["loadAndParseFile","existsSync","path","ReferenceError","readFileSync","JSON","parse","contents","SyntaxError","parsed","lintObject","obj","name","checkProperty","name1","name2","prepareAuthorMetadata","author","prepareMetadata","version","license","src","dist","es2015","module","es5","main","packageParser","metadata","TypeError","getRollupConfig","Date","getFullYear","convertCJS","babili","comments","banner","isEs5","plugins","babel","presets","preset","push","uglify","output","preamble","entry","format","sourceMap","dest","bundler","Promise","all","rollup","configEs5","configEs2015","then","bundles","write","rlb"],"mappings":"kYAEA,QAASA,iBAAT,GAAkC,CACjC,GAAK,CAACC,WAAYC,CAAZ,CAAN,CACC,KAAM,IAAIC,eAAJ,CAAoB,sCAApB,CAAN,CAGD,KAAM,GAAWC,aAAcF,CAAd,CAAjB,CACA,GAAI,EAAJ,CAEA,GAAI,CACH,EAASG,KAAKC,KAAL,CAAYC,CAAZ,CACT,CAAC,QAAY,CACb,KAAM,IAAIC,YAAJ,CAAiB,+CAAjB,CACN,CAED,MAAOC,EACP,CAED,QAASC,WAAT,GAA2B,CAC1B,aAA+B,CAC9B,GAA4B,WAAvB,QAAOC,GAAKC,CAAL,CAAZ,CACC,KAAM,IAAIT,eAAJ,CAAqB,kCAAkCS,CAAM,aAA7D,CAEP,CAQDC,EAAe,MAAf,CAb0B,CAc1BA,EAAe,SAAf,CAd0B,CAe1BA,EAAe,MAAf,CAf0B,CAO1B,aAAyC,CACxC,GAA6B,WAAxB,QAAOF,GAAKG,CAAL,CAAP,EAA+D,WAAxB,QAAOH,GAAKI,CAAL,CAAnD,CACC,KAAM,IAAIZ,eAAJ,CAAqB,yCAAyCW,CAAO,SAASC,CAAO,uBAArF,CAEP,CAKD,CAAiB,QAAjB,CAA2B,aAA3B,CAhB0B,CAiB1BF,EAAe,QAAf,CAjB0B,CAkB1BA,EAAe,SAAf,CACA,CAED,QAASG,sBAAT,GAAyC,OACjB,QAAlB,QAAOC,EAD4B,CAKjCA,EAAOL,IAL0B,CAExBK,CAFwB,GAMxC,CAED,QAASC,gBAAT,GAAgC,CAC/B,MAAO,CACNN,KAAMD,EAAIC,IADJ,CAENO,QAASR,EAAIQ,OAFP,CAGNF,OAAQD,sBAAuBL,EAAIM,MAA3B,CAHF,CAING,QAAST,EAAIS,OAJP,CAKNC,IAAK,cALC,CAMNC,KAAM,CACLC,OAAQZ,EAAIa,MAAJ,EAAcb,EAAK,aAAL,CADjB,CAELc,IAAKd,EAAIe,IAFJ,CANA,CAWP,CAED,QAASC,cAAT,GAAmC,CAClC,GAAyB,QAApB,QAAOC,EAAZ,CACC,EAAW5B,iBAAkB4B,CAAlB,CADZ,KAEO,IAAyB,QAApB,QAAOA,EAAZ,CACN,KAAM,IAAIC,UAAJ,CAAe,2BAAf,CAAN,CAKD,MAFAnB,YAAYkB,CAAZ,CAEA,CAAOV,gBAAiBU,CAAjB,CACP,CCjED,QAASE,gBAAT,KAA4C,CAC3C,KAAM,GAAU,OAAMF,EAAShB,IAAK,KAAIgB,EAAST,OAAQ,UAAS,GAAIY,KAAJ,GAAWC,WAAX,EAAyB,IAAGJ,EAASX,MAAO,MAAKW,EAASR,OAAQ,2BAApI,CACM,EAAU,CACfa,YADe,CAEfC,OAAQ,CACPC,WADO,CAEPC,QAFO,CAAR,CAFe,CADhB,CAuBA,MAdKC,EAcL,GAbCC,EAAS,CAAT,EAAeC,MAAO,CACrBC,QAAS,CACR,CAAEC,MAAF,CADQ,CADY,CAAP,CAahB,CAPCH,EAAQI,IAAR,CAAcC,OAAQ,CACrBC,OAAQ,CACPC,SAAUT,CADH,CADa,CAAR,CAAd,CAOD,EAAO,CACNU,MAAOlB,EAASP,GADV,CAEN0B,OAAQV,EAAQ,KAAR,CAAgB,IAFlB,CAGNW,YAHM,CAINV,SAJM,CAKNF,QALM,CAMNa,KAAMZ,EAAQT,EAASN,IAAT,CAAcG,GAAtB,CAA4BG,EAASN,IAAT,CAAcC,MAN1C,CAQP,CAED,QAAS2B,QAAT,GAA6B,CAC5B,KAAM,GAAYpB,gBAAiBF,CAAjB,IAAlB,CACM,EAAeE,gBAAiBF,CAAjB,IADrB,CAGA,MAAOuB,SAAQC,GAAR,CAAa,CACnBC,SAAQC,CAARD,CADmB,CAEnBA,SAAQE,CAARF,CAFmB,CAAb,EAGHG,IAHG,CAGG,KAAe,CACxB,MAAOL,SAAQC,GAAR,CAAa,CACnBK,EAAS,CAAT,EAAaC,KAAb,CAAoBJ,CAApB,CADmB,CAEnBG,EAAS,CAAT,EAAaC,KAAb,CAAoBH,CAApB,CAFmB,CAAb,CAIP,CARM,CASP,CCnDD,QAASI,IAAT,EAAe,CACd,KAAM,GAAWhC,cAAe,cAAf,CAAjB,CAEA,MAAOuB,SAAStB,CAAT,CACP"}